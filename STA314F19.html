<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Michal Malyska" />


<title>STA314F19</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Michal Malyska</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-university"></span>
     
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="STA130F19.html">
        <span class="fa fa-book"></span>
         
        STA130 - Intro to Data Science Fall 2019
      </a>
    </li>
    <li>
      <a href="STA314F19.html">
        <span class="fa fa-book"></span>
         
        STA314 - Machine Learning I Fall 2019
      </a>
    </li>
    <li>
      <a href="STA220.html">
        <span class="fa fa-book"></span>
         
        STA220 - The Practice of Statistics I Summer 2019
      </a>
    </li>
    <li>
      <a href="STA314.html">
        <span class="fa fa-book"></span>
         
        STA314 - Machine Learning I Fall 2018
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Course Work
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Coursework_Summary.html">
        <span class="fa fa-book"></span>
         
        Coursework Summary
      </a>
    </li>
    <li>
      <a href="STA410_A1.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 1
      </a>
    </li>
    <li>
      <a href="STA410_A2.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 2
      </a>
    </li>
    <li>
      <a href="STA410_A3.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 3
      </a>
    </li>
    <li>
      <a href="STA410_A4.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 4
      </a>
    </li>
    <li>
      <a href="STA447_A2.html">
        <span class="fa fa-code"></span>
         
        STA447 - Stochastic Processes - Assignment 2
      </a>
    </li>
    <li>
      <a href="STA_490_ReactionTimes_Project.html">
        <span class="fa fa-code"></span>
         
        STA490 - Stats Consulting and Collaboration
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-pencil"></span>
     
    Personal Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ASNA2019CC_datacreation.html">
        <span class="fa fa-code"></span>
         
        ASNA2019 Case Competition
      </a>
    </li>
    <li>
      <a href="Kaggle.html">
        <span class="fa fa-code"></span>
         
        Kaggle Competitions
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About me
  </a>
</li>
<li>
  <a href="resume.pdf">
    <span class="fa fa-file-pdf-o"></span>
     
    Resume
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">STA314F19</h1>
<h4 class="author">Michal Malyska</h4>

</div>


<pre class="r"><code>set.seed(1337)

library(tidyverse)
library(MASS)
library(ISLR)

# For working with factors 
library(forcats)</code></pre>
<div id="preliminaries-and-r-setup" class="section level1">
<h1>Preliminaries and R setup</h1>
<div id="resources" class="section level2">
<h2>Resources:</h2>
<p>In case you have never worked with R up until this point, below is a guide to setting everything up. If you are ready, just use the navbar on the left to skip this and go to the first chapter - Visualizations. I would advise that you at least take a look at the packages I am using for this.</p>
</div>
<div id="downloading-r-and-rstudio." class="section level2">
<h2>Downloading R and Rstudio.</h2>
<ol style="list-style-type: decimal">
<li><p>Go to the UofT CRAN <a href="http://cran.utstat.utoronto.ca/">website</a> and download and install R for your Operating System.</p></li>
<li><p>Go to the Rstudio <a href="https://www.rstudio.com/products/rstudio/download/#download">website</a> and download and install it.</p></li>
</ol>
</div>
<div id="downloading-important-packages" class="section level2">
<h2>Downloading important packages</h2>
<p>Open Rstudio, and navigate to the console. Then run the following commands to get the packages I highly recommend you get:</p>
<p>install.packages(c(‘gridExtra’,‘tidyverse’,‘plotly’, ‘GGally’))</p>
<p>You might need to replace the quotation marks if you copypaste this.</p>
<p>This will install all the packages we should need for the class and beyond. Whenever you want to add a package you can either call the command:</p>
<p>install.packages(&lt;quoted package name&gt;)</p>
<p>or navigate to the Files and plots pane in Rstudio, click on packages, then install, and type in the name.</p>
<p><strong>Note that you only need to do this once, and the packages will remain for any R script you are writing.</strong></p>
</div>
<div id="learning" class="section level2">
<h2>Learning</h2>
<p>There is a number of resources available for you to learn and master the tidyverse package, which is what you will be using if you ever work with R. It’s technically not required for the course but it will make your life a lot easier.</p>
<p><a href="http://r4ds.had.co.nz/">Learn R with tidyverse</a> - this on it’s own should give you good enough background to handle most of the coding you will ever do in R, both in class, and in a professional setting.</p>
<p><a href="https://adv-r.hadley.nz/">Advanced R with tidyverse</a> - far beyond the scope of what’s needed for the course, but a great resource if you want to get involved with R.</p>
<p><a href="https://www.rstudio.com/resources/cheatsheets/">Cheatsheets</a> - very useful set of cheatsheets that you should probably keep open whenever you are working with tidyverse. (Especially the visiualization one)</p>
<p><a href="https://evamaerey.github.io/ggplot_flipbook/ggplot_flipbook_xaringan.html">GGPlot Flipbook</a> - The best resource to get familiar with the slightly unintuitive syntax of ggplot.</p>
<p>Some other packages you should consider looking into, that will come handy during this class:</p>
<p>“car” - it is “the package” for regression models.</p>
<p>“summarytools” - contains function “dfSummary” which is the fastest way to get meaningful first glance at the data. It’s a good compromise between the ease of using “summary” or “glance”, and providing as much information as possible.</p>
<p>“forcats” - package for working with factors in r, part of the tidyverse family but not included in the tidyverse itself.</p>
<p>Just to cover all bases below I will show you the simple workflow that I follow when working with a new dataset, like you will be doing during this class.</p>
</div>
<div id="rstudio-setup-and-settings" class="section level2">
<h2>RStudio Setup and settings</h2>
<p>If this is your first time using RStudio, you should adjust your settings:</p>
<ul>
<li><p>Navigate to Tools -&gt; Global Options</p></li>
<li><p>Change “Save workspace to .RData on exit” to Never</p></li>
<li><p>Uncheck “Restore .RData into workspace at startup”</p></li>
</ul>
<p>This is what mine look like:</p>
<p><img src="figures/RStudio%20Setup.png" /></p>
<p>Now, every time you want to start working on something, you should begin by creating an <strong>Rproject</strong>. This helps you keep track of the files, sets your working directory so that data loading is easier, and you should do it almost <strong>always</strong>.</p>
<p>Now that we have all that out of the way let’s start with what to do once you have RStudio open and ready to work.</p>
</div>
<div id="file-setup" class="section level2">
<h2>File Setup</h2>
<p>Since you will need to create pdfs from your code with figures and equations you will be using the knitr package and will be working in .Rmd files. This is the most common way to write anything in R that isn’t pure code. Make sure you have some distribution of LaTeX downloaded as it is necessary to create the pdfs. I recommend MikTeX, but it shouldn’t matter which one you have for this course.</p>
<p>When you create a new .Rmd file you will notice that at the top it will have a header containing the file title, your name and date. If you want to add a table of contents (which is created from headers) just change the output line to look like this:</p>
<p><img src="figures/Table%20of%20contents%20output.png" /></p>
<p>To actually work with pdf creation you will need to download a LaTeX distribution. Navigate to this <a href="https://www.latex-project.org/get/#tex-distributions">link</a>, and download the appropriate one (MacTeX for Macs and MikTeX for Windows).</p>
<p>After you are done restart your R.</p>
</div>
<div id="how-to-work-in-r-without-pain" class="section level2">
<h2>How to work in R without pain</h2>
<div id="projects" class="section level3">
<h3>Projects</h3>
<p>Each time you work on a new “thing” whether it be a course, or research, I recommend you set up a project. The way to do it is:</p>
<ol style="list-style-type: decimal">
<li><p>Open RStudio</p></li>
<li><p>Look in the top right corner, you will see a project icon.</p></li>
</ol>
<p><img src="figures/RStudioProject.png" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Click it and select New Project, then select New Directory</li>
</ol>
<p><img src="figures/RStudioProject2.png" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Create your new folder (It creates a regular folder with a special file inside)</li>
</ol>
<p><img src="figures/RStudioProject3.png" /></p>
<p>Now whenever you work in RStudio just open up the project and work there. It will automatically set your working directory to that folder, and open up all the files you had open previously. You can tell that the project is open by looking in the top right corner again. This website is written in an RProject I called “Files” so when I look in my top right corner I see this:</p>
<p><img src="figures/RStudioProject4.png" /></p>
<p>Once you are in a project you should work in RMarkdown files, and knit them to pdf. That way you get very crisp, clean project reports.</p>
</div>
</div>
<div id="packages" class="section level2">
<h2>Packages</h2>
<p>At the start of each file you should also load ALL the packages you will be using. Please don’t scatter library calls throughout your file.</p>
<pre class="r"><code>library(gridExtra)
#library(summarytools) ### There is a problem with summarytools on the current R version
library(tidyverse)
library(forcats)
library(GGally)


set.seed(217828) # This line makes the random generation for this file be the same
# Every time it is run


library(plotly) # You don&#39;t need this
library(gganimate) # Or this</code></pre>
</div>
<div id="loading-data" class="section level2">
<h2>Loading Data</h2>
<p>First let’s see how we would load data from a downloaded “.csv” file:</p>
<p>The example dataset will be the one create for the Actuarial Students National Association case competition technical challenge from this year. If you are interested in how the data was created you can check out the personal projects tab and find it under “ASNA Case Comp”.</p>
<pre class="r"><code># Load in the example.csv file that is in the working directory (this is assuming either the project
# was created or manual change of working directory happened before this line)

# Using Base reading (not advised)
data1 &lt;- read.csv(&quot;training_data.csv&quot;)

# Using Tidyverse loading
data2 &lt;- read_csv(&quot;training_data.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_double(),
##   Education = col_character(),
##   EmploymentStatus = col_character(),
##   Income = col_double(),
##   `Marital Status` = col_character(),
##   `State Code` = col_character(),
##   Coverage = col_character(),
##   Gender = col_character(),
##   `Location Code` = col_character(),
##   `Monthly Premium Auto` = col_double(),
##   `Months Since Last Claim` = col_double(),
##   `Months Since Policy Inception` = col_double(),
##   `Number of Open Complaints` = col_double(),
##   `Number of Policies` = col_double(),
##   `Claim Reason` = col_character(),
##   `Sales Channel` = col_character(),
##   `Vehicle Class` = col_character(),
##   `Vehicle Size` = col_character(),
##   `Claim Class` = col_double()
## )</code></pre>
<pre class="r"><code># Load data specifying all possible options:
data3 &lt;- read_csv(file = &quot;training_data.csv&quot;, # file path relative to WD
                  col_names = TRUE, # Does the file include column names
                  na = c(&quot;&quot;, &quot;NA&quot;, &quot;N/A&quot;), # What are the missing values in the file 
                  #(specified in a vector)
                  quoted_na = TRUE, # should missing values inside of quotes be missing
                  skip = 0, # How many lines to skip
                  n_max = Inf, # How many lines to read at most (Inf = infinity)
                  guess_max = 10000 # How many records to use to guess the type of column
                  # if not specified in col_types = c()
                  )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_double(),
##   Education = col_character(),
##   EmploymentStatus = col_character(),
##   Income = col_double(),
##   `Marital Status` = col_character(),
##   `State Code` = col_character(),
##   Coverage = col_character(),
##   Gender = col_character(),
##   `Location Code` = col_character(),
##   `Monthly Premium Auto` = col_double(),
##   `Months Since Last Claim` = col_double(),
##   `Months Since Policy Inception` = col_double(),
##   `Number of Open Complaints` = col_double(),
##   `Number of Policies` = col_double(),
##   `Claim Reason` = col_character(),
##   `Sales Channel` = col_character(),
##   `Vehicle Class` = col_character(),
##   `Vehicle Size` = col_character(),
##   `Claim Class` = col_double()
## )</code></pre>
<pre class="r"><code># This is to remove two of the redundant data files from my wd
df &lt;- data3
rm(list = c(&quot;data1&quot;, &quot;data2&quot;, &quot;data3&quot;))</code></pre>
<p>In most cases you will want to specify at least some of the parameters from the cell above, especially helpful is guess_max, and na. However in this course we will be working mostly with nicely formatted data so it shouldn’t be an issue.</p>
</div>
</div>
<div id="tutorial-1" class="section level1">
<h1>Tutorial 1</h1>
</div>
<div id="tutorial-2" class="section level1">
<h1>Tutorial 2</h1>
</div>
<div id="tutorial-3" class="section level1">
<h1>Tutorial 3</h1>
<div id="lab" class="section level2">
<h2>Lab</h2>
<pre class="r"><code>data_orig &lt;- MASS::Boston

df &lt;- as_tibble(data_orig)


df_train &lt;- df %&gt;% sample_n(size = length(df$chas) * 0.7)

df_test &lt;- setdiff(df, df_train)</code></pre>
<p>Let’s start by showing off what bad practice is and fit a linear model without doing any kind of previous work:</p>
<pre class="r"><code>model1 &lt;- lm(medv ~ lstat, data = df_train)
summary(model1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat, data = df_train)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -10.101  -4.074  -1.285   1.891  24.249 
## 
## Coefficients:
##             Estimate Std. Error t value            Pr(&gt;|t|)    
## (Intercept) 34.95053    0.67527   51.76 &lt;0.0000000000000002 ***
## lstat       -0.96530    0.04638  -20.82 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.269 on 352 degrees of freedom
## Multiple R-squared:  0.5517, Adjusted R-squared:  0.5505 
## F-statistic: 433.3 on 1 and 352 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<pre class="r"><code>plot(model1)</code></pre>
<p><img src="STA314F19_files/figure-html/Model%20Assumptions-1.png" width="576" /><img src="STA314F19_files/figure-html/Model%20Assumptions-2.png" width="576" /><img src="STA314F19_files/figure-html/Model%20Assumptions-3.png" width="576" /><img src="STA314F19_files/figure-html/Model%20Assumptions-4.png" width="576" /></p>
<p>Assumptions are not satisfied!</p>
<pre class="r"><code>ggplot(data = df, aes(x = medv, y = ..density..)) +
  geom_density() +
  geom_histogram(bins = 75, alpha = 0.3, fill = &quot;red&quot;) +
  theme_minimal()</code></pre>
<p><img src="STA314F19_files/figure-html/Looking%20at%20distribution%20of%20response-1.png" width="576" /></p>
<pre class="r"><code>ggplot(data = df, aes(sample = medv)) +
  geom_qq() +
  geom_qq_line() +
  theme_minimal()</code></pre>
<p><img src="STA314F19_files/figure-html/Looking%20at%20distribution%20of%20response-2.png" width="576" /></p>
<pre class="r"><code>ggplot(data = df, aes(y = medv, x = lstat)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, color = &quot;red&quot;) +
  geom_smooth(method = &quot;gam&quot;, formula = y ~ s(x, bs = &quot;cs&quot;), color = &quot;green&quot;) +
  geom_smooth(method = &quot;lm&quot;, formula = y ~ x + I(x^2), color = &quot;blue&quot;) +
  theme_minimal()</code></pre>
<p><img src="STA314F19_files/figure-html/Looking%20at%20distribution%20of%20response-3.png" width="576" /></p>
<p>How to make predictions:</p>
<pre class="r"><code>df_test$predictions &lt;- predict(model1, newdata = df_test)</code></pre>
<p>How to add multiple variables as predictors:</p>
<pre class="r"><code>model2 &lt;- lm(data = df_train, formula = medv ~ lstat + age)
summary(model2)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat + age, data = df_train)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -10.328  -3.989  -1.435   2.054  22.398 
## 
## Coefficients:
##             Estimate Std. Error t value             Pr(&gt;|t|)    
## (Intercept) 33.03263    0.87906  37.577 &lt; 0.0000000000000002 ***
## lstat       -1.07290    0.05593 -19.184 &lt; 0.0000000000000002 ***
## age          0.04795    0.01435   3.341             0.000925 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.181 on 351 degrees of freedom
## Multiple R-squared:  0.5656, Adjusted R-squared:  0.5631 
## F-statistic: 228.5 on 2 and 351 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<pre class="r"><code>plot(model2)</code></pre>
<p><img src="STA314F19_files/figure-html/MLR-1.png" width="576" /><img src="STA314F19_files/figure-html/MLR-2.png" width="576" /><img src="STA314F19_files/figure-html/MLR-3.png" width="576" /><img src="STA314F19_files/figure-html/MLR-4.png" width="576" /></p>
<p>How to add everything (and subtract some) variables:</p>
<pre class="r"><code>model3 &lt;- lm(data = df_train, formula = medv ~ . -age -indus)
summary(model3)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ . - age - indus, data = df_train)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.3851  -3.0634  -0.7881   1.8407  23.8259 
## 
## Coefficients:
##               Estimate Std. Error t value             Pr(&gt;|t|)    
## (Intercept)  43.396281   6.193223   7.007       0.000000000013 ***
## crim         -0.116778   0.041475  -2.816              0.00515 ** 
## zn            0.034244   0.017659   1.939              0.05330 .  
## chas          2.807666   1.075737   2.610              0.00945 ** 
## nox         -17.610598   4.398754  -4.004       0.000076564298 ***
## rm            3.027264   0.487210   6.213       0.000000001506 ***
## dis          -1.520936   0.233795  -6.505       0.000000000275 ***
## rad           0.357294   0.082738   4.318       0.000020618157 ***
## tax          -0.012594   0.004461  -2.823              0.00504 ** 
## ptratio      -0.980581   0.162278  -6.043       0.000000003962 ***
## black         0.009449   0.003460   2.731              0.00665 ** 
## lstat        -0.620182   0.060069 -10.325 &lt; 0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.027 on 342 degrees of freedom
## Multiple R-squared:  0.7199, Adjusted R-squared:  0.7109 
## F-statistic: 79.92 on 11 and 342 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<p>How to add interactions:</p>
<pre class="r"><code>model4 &lt;- lm(data = df_train, formula = medv ~ . -age -indus + lstat:ptratio )
summary(model4)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ . - age - indus + lstat:ptratio, data = df_train)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -14.9747  -2.9978  -0.8228   1.7182  24.1724 
## 
## Coefficients:
##                 Estimate Std. Error t value      Pr(&gt;|t|)    
## (Intercept)    47.348632   7.588867   6.239 0.00000000130 ***
## crim           -0.121372   0.041798  -2.904      0.003927 ** 
## zn              0.030603   0.018119   1.689      0.092137 .  
## chas            2.907145   1.081673   2.688      0.007549 ** 
## nox           -15.903558   4.789972  -3.320      0.000997 ***
## rm              2.915639   0.502822   5.799 0.00000001526 ***
## dis            -1.453775   0.245435  -5.923 0.00000000771 ***
## rad             0.356875   0.082762   4.312 0.00002120067 ***
## tax            -0.013301   0.004531  -2.936      0.003555 ** 
## ptratio        -1.203747   0.295983  -4.067 0.00005920744 ***
## black           0.009572   0.003464   2.763      0.006029 ** 
## lstat          -1.008292   0.434609  -2.320      0.020931 *  
## ptratio:lstat   0.020383   0.022605   0.902      0.367869    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.029 on 341 degrees of freedom
## Multiple R-squared:  0.7206, Adjusted R-squared:  0.7108 
## F-statistic: 73.28 on 12 and 341 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<p>How to write high level interactions:</p>
<pre class="r"><code>model5 &lt;- lm(data = df_train, formula = medv ~ lstat*ptratio*black)
summary(model5)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat * ptratio * black, data = df_train)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -12.7835  -3.5310  -0.8976   1.6660  27.1487 
## 
## Coefficients:
##                        Estimate  Std. Error t value Pr(&gt;|t|)
## (Intercept)         -20.0358289  52.0839733  -0.385    0.701
## lstat                 1.6533724   2.9025591   0.570    0.569
## ptratio               1.9336021   2.6432879   0.732    0.465
## black                 0.2234851   0.1368595   1.633    0.103
## lstat:ptratio        -0.0958973   0.1460792  -0.656    0.512
## lstat:black          -0.0096108   0.0077186  -1.245    0.214
## ptratio:black        -0.0095943   0.0069592  -1.379    0.169
## lstat:ptratio:black   0.0004143   0.0003893   1.064    0.288
## 
## Residual standard error: 5.78 on 346 degrees of freedom
## Multiple R-squared:  0.6254, Adjusted R-squared:  0.6178 
## F-statistic: 82.52 on 7 and 346 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<p>This is what our data looks like:</p>
<pre class="r"><code>ggplot(data = df_train, aes(x = lstat, y = medv)) +
  geom_point() +
  theme_minimal()</code></pre>
<p><img src="STA314F19_files/figure-html/Nonlinear%20factors-1.png" width="576" /></p>
<p>How to add a funciton of a variable as a predictor and how to make simple visualizations without adding predictions:</p>
<pre class="r"><code>model6 &lt;- lm(data = df_train, formula = medv ~ lstat + I(lstat^2))
summary(model6)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ lstat + I(lstat^2), data = df_train)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -10.9741  -3.7746  -0.4845   2.4320  25.1016 
## 
## Coefficients:
##              Estimate Std. Error t value            Pr(&gt;|t|)    
## (Intercept) 43.200104   1.036576  41.676 &lt;0.0000000000000002 ***
## lstat       -2.321884   0.145001 -16.013 &lt;0.0000000000000002 ***
## I(lstat^2)   0.042125   0.004317   9.758 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.568 on 351 degrees of freedom
## Multiple R-squared:  0.6474, Adjusted R-squared:  0.6454 
## F-statistic: 322.2 on 2 and 351 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<pre class="r"><code>ggplot(data = df_train, aes(x = lstat, y = medv)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, formula = y ~ x + I(x^2)) +
  theme_minimal()</code></pre>
<p><img src="STA314F19_files/figure-html/unnamed-chunk-2-1.png" width="576" /></p>
<p>How to fit higher degree polynomials and visualize them:</p>
<pre class="r"><code>model7 &lt;- lm(data = df_train, formula = medv ~ poly(lstat, degree = 5))
summary(model7)</code></pre>
<pre><code>## 
## Call:
## lm(formula = medv ~ poly(lstat, degree = 5), data = df_train)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -13.3723  -3.1633  -0.7816   2.0235  26.6882 
## 
## Coefficients:
##                           Estimate Std. Error t value             Pr(&gt;|t|)
## (Intercept)                22.7251     0.2819  80.620 &lt; 0.0000000000000002
## poly(lstat, degree = 5)1 -130.4922     5.3036 -24.605 &lt; 0.0000000000000002
## poly(lstat, degree = 5)2   54.3320     5.3036  10.244 &lt; 0.0000000000000002
## poly(lstat, degree = 5)3  -19.9810     5.3036  -3.767             0.000194
## poly(lstat, degree = 5)4   20.5430     5.3036   3.873             0.000128
## poly(lstat, degree = 5)5  -16.5152     5.3036  -3.114             0.001999
##                             
## (Intercept)              ***
## poly(lstat, degree = 5)1 ***
## poly(lstat, degree = 5)2 ***
## poly(lstat, degree = 5)3 ***
## poly(lstat, degree = 5)4 ***
## poly(lstat, degree = 5)5 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.304 on 348 degrees of freedom
## Multiple R-squared:  0.6828, Adjusted R-squared:  0.6783 
## F-statistic: 149.8 on 5 and 348 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<pre class="r"><code>ggplot(data = df_train, aes(x = lstat, y = medv)) +
  geom_point() +
  geom_smooth(method = &quot;lm&quot;, formula = y ~ poly(x, degree = 5)) +
  theme_minimal()</code></pre>
<p><img src="STA314F19_files/figure-html/unnamed-chunk-3-1.png" width="576" /></p>
<p>How to change plotting settings in base R (For tidyverse you should use gridExtra)</p>
<pre class="r"><code>par(mfrow = c(2,2))
plot(model6)</code></pre>
<p><img src="STA314F19_files/figure-html/parmfrow-1.png" width="576" /></p>
<p>Fitting character variables:</p>
<pre class="r"><code>df2 &lt;- ISLR::Carseats

df2_train &lt;- sample_n(df2, size = length(df2$Sales) * 0.7)
df2_test &lt;- setdiff(df2, df2_train)

glimpse(df2_train)</code></pre>
<pre><code>## Observations: 280
## Variables: 11
## $ Sales       &lt;dbl&gt; 4.88, 2.52, 5.64, 9.70, 4.53, 9.53, 9.03, 1.42, 7.38…
## $ CompPrice   &lt;dbl&gt; 121, 124, 124, 138, 114, 175, 104, 99, 98, 155, 150,…
## $ Income      &lt;dbl&gt; 47, 61, 24, 61, 113, 65, 102, 32, 120, 80, 68, 53, 9…
## $ Advertising &lt;dbl&gt; 3, 0, 5, 12, 0, 29, 13, 18, 0, 0, 5, 0, 14, 15, 6, 0…
## $ Population  &lt;dbl&gt; 220, 333, 288, 156, 97, 419, 123, 341, 268, 237, 125…
## $ Price       &lt;dbl&gt; 107, 138, 122, 120, 125, 166, 110, 108, 93, 124, 136…
## $ ShelveLoc   &lt;fct&gt; Bad, Medium, Medium, Medium, Medium, Medium, Good, B…
## $ Age         &lt;dbl&gt; 56, 76, 57, 25, 29, 53, 35, 80, 72, 37, 64, 41, 48, …
## $ Education   &lt;dbl&gt; 16, 16, 12, 14, 12, 12, 16, 16, 10, 14, 13, 12, 15, …
## $ Urban       &lt;fct&gt; No, Yes, No, Yes, Yes, Yes, Yes, Yes, No, Yes, No, Y…
## $ US          &lt;fct&gt; Yes, No, Yes, Yes, No, Yes, Yes, Yes, No, No, Yes, N…</code></pre>
<pre class="r"><code># Fit a model with a catergorical variable
model7 &lt;- lm(data = df2_train, formula = Sales ~ ShelveLoc)
summary(model7)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Sales ~ ShelveLoc, data = df2_train)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.3748 -1.6324  0.1064  1.6277  5.6765 
## 
## Coefficients:
##                 Estimate Std. Error t value             Pr(&gt;|t|)    
## (Intercept)       5.5035     0.2938  18.731 &lt; 0.0000000000000002 ***
## ShelveLocGood     4.8989     0.4226  11.591 &lt; 0.0000000000000002 ***
## ShelveLocMedium   1.8713     0.3461   5.407          0.000000139 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.314 on 277 degrees of freedom
## Multiple R-squared:  0.3318, Adjusted R-squared:  0.3269 
## F-statistic: 68.76 on 2 and 277 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<pre class="r"><code># What are ShelveLocGood and ShelveLocMedium 
contrasts(df2$ShelveLoc)</code></pre>
<pre><code>##        Good Medium
## Bad       0      0
## Good      1      0
## Medium    0      1</code></pre>
<pre class="r"><code>Load_packages &lt;- function(){
  library(tidyverse)
  library(MASS)
  library(ISLR)
}</code></pre>
<pre class="r"><code>Load_packages()</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
