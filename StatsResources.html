<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Michal Malyska" />


<title>R Resources</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Michal Malyska</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-university"></span>
     
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="STA130F19.html">
        <span class="fa fa-book"></span>
         
        STA130 - Intro to Data Science Fall 2019
      </a>
    </li>
    <li>
      <a href="STA314F19.html">
        <span class="fa fa-book"></span>
         
        STA314 - Machine Learning I Fall 2019
      </a>
    </li>
    <li>
      <a href="STA220.html">
        <span class="fa fa-book"></span>
         
        STA220 - The Practice of Statistics I Summer 2019
      </a>
    </li>
    <li>
      <a href="STA314.html">
        <span class="fa fa-book"></span>
         
        STA314 - Machine Learning I Fall 2018
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Course Work
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Coursework_Summary.html">
        <span class="fa fa-book"></span>
         
        Coursework Summary
      </a>
    </li>
    <li>
      <a href="STA410_A1.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 1
      </a>
    </li>
    <li>
      <a href="STA410_A2.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 2
      </a>
    </li>
    <li>
      <a href="STA410_A3.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 3
      </a>
    </li>
    <li>
      <a href="STA410_A4.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 4
      </a>
    </li>
    <li>
      <a href="STA447_A2.html">
        <span class="fa fa-code"></span>
         
        STA447 - Stochastic Processes - Assignment 2
      </a>
    </li>
    <li>
      <a href="STA_490_ReactionTimes_Project.html">
        <span class="fa fa-code"></span>
         
        STA490 - Stats Consulting and Collaboration
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-pencil"></span>
     
    Personal Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ASNA2019CC_datacreation.html">
        <span class="fa fa-code"></span>
         
        ASNA2019 Case Competition
      </a>
    </li>
    <li>
      <a href="Kaggle.html">
        <span class="fa fa-code"></span>
         
        Kaggle Competitions
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-code"></span>
     
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="RResources.html">
        <span class="fa fa-book"></span>
         
        RStudio / R resources
      </a>
    </li>
    <li>
      <a href="StatsResources.html">
        <span class="fa fa-book"></span>
         
        General Statistics resources
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About me
  </a>
</li>
<li>
  <a href="resume.pdf">
    <span class="fa fa-file-pdf-o"></span>
     
    Resume
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">R Resources</h1>
<h4 class="author">Michal Malyska</h4>

</div>


<p>This file will be a compliation of all the statistics resources I encounter / make that I think are worth spending some more time on outside of the classroom.</p>
<div id="assessing-normality" class="section level1">
<h1>Assessing Normality</h1>
<p>This is a guide I originally wrote as additional materials for STA220 in the summer of 2019.</p>
<p>Most people starting their journey in statistics<br />
struggle with something that used to be problematic for me as well - assessing normality from Normal QQ-plots. Understandably, It’s very difficult to quantify how much does a plot look like a “normal” Normal QQ-plot would, especially at smaller sample sizes. I want to show you two approaches that have helped me, and that I usually resort to, when looking for normality.</p>
<div id="shapiro-wilk-test" class="section level2">
<h2>Shapiro Wilk test</h2>
<div id="description-and-example" class="section level3">
<h3>Description and Example</h3>
<p>Shapiro Wilk test is conceptually somewhat similar to what you’ve seen so far for assesing the equality of variances - the F test. The null hypothesis is that the data comes from a normal distribution, and looks to see if the the data gives evidence against that assumption. The test statistic is beyond the scope of this course, and is an example of something you will learn if you take STA355. If you’re interested you can just look at the wikipedia page. One very good property of the Shapiro-Wilk test is that it been shown that it has the best power for a given significance - meaning it is most likely to reject the null given that the data is not normal for a given significance level.</p>
<p>There are no new packages for you to install to be able to run a Shapiro-Wilk test in R, the function is built in with the name shapiro.test(). You can find an example code, where I assess the normality of 5 different generated datasets.</p>
<pre class="r"><code># First, I&#39;m gonna generate a few sample datasets for our tests:
ex1 &lt;- rnorm(5000)
ex2 &lt;- rt(100, 3)
ex3 &lt;- sample(c(1,-1),size = 1000 ,replace = TRUE)*(rexp(1000, rate = 5) - 5)
ex4 &lt;- rcauchy(250)
ex5 &lt;- rnorm(15)
ex6 &lt;- rt(50, 1)

# Then I will perform shapiro wilk tests on all of them and see how well it performs:

test1 &lt;- shapiro.test(ex1)
test2 &lt;- shapiro.test(ex2)
test3 &lt;- shapiro.test(ex3)
test4 &lt;- shapiro.test(ex4)
test5 &lt;- shapiro.test(ex5)
test6 &lt;- shapiro.test(ex6)

# Let&#39;s see the p-values for each of the tests:

p_vals &lt;- tibble(normal = as_factor(c(&quot;Yes&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot; ,&quot;Yes&quot;, &quot;No&quot;)),
                 p_val = c(test1$p.value, test2$p.value,
                          test3$p.value, test4$p.value,
                          test5$p.value, test6$p.value))

ggplot(data = p_vals) +
    aes(x = normal) + 
    aes(y = p_val) +
    aes(col = fct_inorder(normal)) +
    scale_color_manual(name = &quot;&quot;, values = c(&quot;green&quot;, &quot;red&quot;)) +
    geom_jitter(width = 0.1, height = 0, size = 4) +
    labs(title = &quot;P-values of Shapiro-Wilk test for the example datasets&quot;,
         x = &quot;Normal?&quot;,
         y = &quot;P-value&quot;) +
    geom_hline(yintercept = 0.05, lty = 2, col = &quot;red&quot;) +
    theme_bw(base_size = 12) +
    scale_y_continuous(limits = c(0,1))</code></pre>
<p><img src="StatsResources_files/figure-html/Shapiro-Wilk%20Examples-1.png" width="576" /></p>
<p>We can see that it peforms quite well, in fact all the p-values for non-normal distributions are so close to 0, I had to add sideways jitter for you to be able to tell them apart.</p>
</div>
<div id="simulations" class="section level3">
<h3>Simulations</h3>
<p>Now I will try to see it’s behaviour under the null hypothesis, by simulating normals and looking at the distribution of p-values.</p>
<pre class="r"><code>new_pvals &lt;- NULL

for (i in 1:1000) {
    ex7 &lt;- rnorm(100)
    test7 &lt;- shapiro.test(ex7)
    new_pvals &lt;- c(new_pvals, test7$p.value)
}

new_pvals &lt;- tibble(ID = 1:1000,
                    p_values = new_pvals,
                    reject = if_else(p_values &lt; 0.05, TRUE, FALSE))

ggplot(data = new_pvals) +
    aes(y = p_values) +
    aes(x = ID) +
    aes(col = reject) +
    geom_point(size = 1) +
    scale_color_manual(name = &quot;&quot;, values = c(&quot;green&quot;, &quot;red&quot;),
                       labels = c(&quot;Don&#39;t reject&quot;, &quot;Reject&quot;)) +
    labs(title = &quot;P-values of Shapiro-Wilk test for normal simulation&quot;,
         x = &quot;ID&quot;,
         y = &quot;P-value&quot;) +
    geom_hline(yintercept = 0.05, lty = 2, col = &quot;red&quot;) +
    theme_bw(base_size = 12) +
    scale_y_continuous(limits = c(0,1))</code></pre>
<p><img src="StatsResources_files/figure-html/Shapiro-Wilk%20for%20normals-1.png" width="576" /></p>
<pre class="r"><code>prop_reject &lt;- mean(new_pvals$reject)</code></pre>
<p>Now this plot doesn’t tell us too many new things, but you can clearly see the uniform distribution of p-values under the null hypothesis (again if you want to learn more you can take STA355), and we can see that at the <span class="math inline">\(\alpha = 0.05\)</span> we rejected 0.05 of the simulations, which is exactly what we would expect. Now how about seeing how it performs distinguishing t-distributions with higher and higher degrees of freedom from normals. Again I will run the simulation:</p>
<pre class="r"><code># I will run a simulation of 1000 tests each from t distributions with varying degrees
# of freedom.

dfs &lt;- c(1, 2, 3, 4, 5, 10, 20, 50, 100, 1000)

new_pvals &lt;- NULL
dfs_ind &lt;- NULL

for (df in dfs) {
    for (i in 1:1000) {
        ex8 &lt;- rt(100, df = df)
        test8 &lt;- shapiro.test(ex8)
        dfs_ind &lt;- c(dfs_ind, df)
        new_pvals &lt;- c(new_pvals, test8$p.value)
    }
}

new_pvals &lt;- tibble(ID = 1:length(dfs_ind),
                    degrees = as.character(dfs_ind),
                    p_values = new_pvals,
                    reject = if_else(p_values &lt; 0.05, &quot;Reject&quot;, &quot;Don&#39;t reject&quot;))

ggplot(data = new_pvals) +
    aes(y = p_values) +
    aes(x = as.factor(dfs_ind)) +
    aes(col = reject) +
    geom_jitter(width = 0.1, height = 0, size = 1) +
    scale_color_manual(name = &quot;&quot;, values = c(&quot;red&quot;, &quot;green&quot;),
                       labels = c(&quot;Don&#39;t reject&quot;, &quot;Reject&quot;)) +
    labs(title = &quot;P-values of Shapiro-Wilk test for t simulation&quot;,
         x = &quot;Degrees of Freedom&quot;,
         y = &quot;P-value&quot;) +
    geom_hline(yintercept = 0.05, lty = 2, col = &quot;red&quot;) +
    theme_bw(base_size = 12) +
    scale_y_continuous(limits = c(0,1))</code></pre>
<p><img src="StatsResources_files/figure-html/Shapiro-Wilk%20for%20t-1.png" width="576" /></p>
<pre class="r"><code>p_vals_summary &lt;- new_pvals %&gt;% group_by(degrees) %&gt;%
    summarize(reject_prob = mean(p_values &lt; 0.05)) %&gt;%
    mutate(degrees = as.integer(degrees)) %&gt;%
    arrange(degrees)

print(p_vals_summary)</code></pre>
<pre><code>## # A tibble: 10 x 2
##    degrees reject_prob
##      &lt;int&gt;       &lt;dbl&gt;
##  1       1       1    
##  2       2       0.984
##  3       3       0.89 
##  4       4       0.694
##  5       5       0.544
##  6      10       0.212
##  7      20       0.101
##  8      50       0.062
##  9     100       0.067
## 10    1000       0.066</code></pre>
<p>As we can see beyond 50 degrees of freedom we are not able to distinguish a t distribution from a normal even with a large sample (1000). Try thinking what would happen if we only had 100 or fewer datapoints. What is interesting to see is that even for 2 degrees of freedom there are some samples that didn’t provide enough evidence to reject the normality assumption.</p>
</div>
<div id="discussion-and-limitations" class="section level3">
<h3>Discussion and Limitations</h3>
<p>Shapiro-Wilk has a very nice property of giving us something tangible to talk about when assessing normality of our data. However it has one limitation that is worth keeping in mind - it only works on sample sizes up to 5000 points. Of course there are ways to get around that problem (Try thinking about how you would do this!)</p>
<p>My Approach:</p>
<div id="spoiler" style="display:none">
<p>I would try taking a bunch of random samples (with or without replacement) of size 5000 from my dataset and run them through the test (this is called bootstrapping if you’re interested), and then I would take the average of p-values as my estimate of the real p-value. I have no idea if this is q correct approach, and once I find out I will update this. Maybe will just include a simulation to confirm. Maybe you can try writing one and verifying and letting me know?</p>
</div>
<button title="Answer" type="button" onclick="if(document.getElementById('spoiler') .style.display=='none')
              {document.getElementById('spoiler') .style.display=''}
            else{document.getElementById('spoiler') .style.display='none'}">
Show/hide
</button>
</div>
</div>
<div id="normal-q-q-plots" class="section level2">
<h2>Normal Q-Q Plots</h2>
<div id="unnecessary-introduction" class="section level3">
<h3>Unnecessary introduction</h3>
<div id="unnecessary intro" style="display:none">
<p>How do we know what does it mean for a plot to be what we expect it to be ? Recently (Jan 23rd 2019) a <a href="https://export.arxiv.org/abs/1901.07851">paper</a> was posted to arxiv. It talks about training Machine Learning models to develop image dis-similarity measures to define a distance of any Q-Q plot from the expected one. I suggest we don’t do that every time we want to assess normality in this class, although I will be really impressed if someone attempts and succeeds at reproducing the results. This could be an interesting project for a class like CSC421.</p>
</div>
<button title="Show me the unnecessary introduction" type="button" onclick="if(document.getElementById('unnecessary intro') .style.display=='none')
              {document.getElementById('unnecessary intro') .style.display=''}
            else{document.getElementById('unnecessary intro') .style.display='none'}">
Show/hide the unnecessary introduction
</button>
<p>As you can probably tell I am overly excited that I now know how to make buttons in Rmarkdown that will go on my website.</p>
</div>
<div id="interpreting-q-q-plots" class="section level3">
<h3>Interpreting Q-Q Plots</h3>
<p>The general idea behind interpreting Normal Q-Q plots is that we transform our data in a very specific way. Again, if you want to know a bit more, take STA355. For the purpose of this course all you need to know is that you will expect the newly transformed data to lie on a straight line y = x. However, because the world is not ideal, we will always have data that doesn’t lie on that straight line exactly, that would be too easy. This doesn’t necessarily mean that we have outliers. I’m actually quite convinced that the probability of all points being exactly on that line is exactly 0 for a given sample larger than a few points.</p>
</div>
<div id="my-solution" class="section level3">
<h3>My solution</h3>
<p>So let’s say I am looking at a nice small set of 100 observations. How do I assess the normality in practice ? Back when I was taking my first steps in R and data analysis, as you are now, I struggled with this immensly and always resorted to Shapiro-Wilk to avoid the problem. Then sometime last year I stumbled upon an article that proposed a solution so simple yet so brilliant I am still quite angry for not coming up with it on my own.</p>
<pre class="r"><code># Let&#39;s say I have some data, distribution of which I don&#39;t know. 
my_data &lt;- rnorm(100) # Let&#39;s pretend this never happened

prepare_grid &lt;- function(my_data, multiplier = 8){
    
# Simulate 3, 8, 15 or some other (perfect square - 1) number of standard normals
# with the same sample size

l &lt;- length(my_data)

my_normals &lt;- rnorm(n = multiplier * l)
combined_data &lt;- tibble(ID = c(rep(1, l), # ID for my data
                               rep(2:(multiplier + 1), l)), # ID&#39;s for the normals
                        points = c(scale(my_data), my_normals)) %&gt;%
    arrange(ID) %&gt;% 
    mutate(ID = as.factor(as.character(ID)),
           ID2 = fct_anon(ID)) # Randomly shuffled ID&#39;s 


plot &lt;- ggplot(data = combined_data) +
    aes(sample = points) +
    theme_bw() +
    geom_qq() +
    geom_qq_line() +
    facet_wrap(.~ID2) +
    labs(title = &quot;Randomly Arranged Q-Q Plots&quot;)

real_id &lt;- as.integer(combined_data[1,3])
return(list(plot = plot, real_id = real_id))
}

prepare_grid(my_data)</code></pre>
<pre><code>## $plot</code></pre>
<p><img src="StatsResources_files/figure-html/QQplot%20solution-1.png" width="576" /></p>
<pre><code>## 
## $real_id
## [1] 3</code></pre>
<p>As the title suggests I randomly arrange our data in a grid with 8 random normals. The trick is - if I can tell which one is my data from the plot, then it’s probably not normal. Feel free to use this function as you please, all I ask from you is that you give me credit for writing it, when using it.</p>
<p>Now let’s use old simulated data that is not normal and see if you are able to tell where it is in the grid. (Feel free to play around on your own)</p>
<pre class="r"><code>prepare_grid(ex2)</code></pre>
<pre><code>## $plot</code></pre>
<p><img src="StatsResources_files/figure-html/Playing%20around%20with%20the%20new%20function-1.png" width="576" /></p>
<pre><code>## 
## $real_id
## [1] 5</code></pre>
<pre class="r"><code>prepare_grid(ex3)</code></pre>
<pre><code>## $plot</code></pre>
<p><img src="StatsResources_files/figure-html/Playing%20around%20with%20the%20new%20function-2.png" width="576" /></p>
<pre><code>## 
## $real_id
## [1] 1</code></pre>
<pre class="r"><code>prepare_grid(ex4)</code></pre>
<pre><code>## $plot</code></pre>
<p><img src="StatsResources_files/figure-html/Playing%20around%20with%20the%20new%20function-3.png" width="576" /></p>
<pre><code>## 
## $real_id
## [1] 2</code></pre>
<pre class="r"><code>prepare_grid(ex6)</code></pre>
<pre><code>## $plot</code></pre>
<p><img src="StatsResources_files/figure-html/Playing%20around%20with%20the%20new%20function-4.png" width="576" /></p>
<pre><code>## 
## $real_id
## [1] 2</code></pre>
<p>In this class however, you should also be able to interpret QQ plots on their own. I will provide some intuition that I now use whenever looking at them, that I already showed in my tutorials.</p>
<p>All you need to know about how to view QQplots is that they try to measure how does your sample compare to a normal distribution with the same mean and standard deviation. In the ideal scenario points would fall exactly on the line. X axis is what you expect from a normal distribution, and Y axis is what you have actually observed. The middle part will usually fit very close to the line so you should focus on the right and left portions of the graph (tails). If the middle points are far away from the line you have a much bigger problem. The way to think about it is - Right side of the graph (higher theoretical quantiles) are the datapoints that have high values.</p>
<p>Let’s see an example.</p>
<pre class="r"><code># ggplot qqplot
rs &lt;- ggplot(data = distributions) +
    aes(sample = right_skewed) +
    theme_minimal() +
    geom_qq() +
    geom_qq_line() +
    coord_fixed() +
    labs(title = &quot;Right Skewed Distribution&quot;)
rs</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Right%20Skew%20QQ-1.png" width="576" /></p>
<p>You should immediately notice that the points both on the right and on the left fall above the line. The way to interpret it is:</p>
<ul>
<li><p>Since points on the right side (high on the X axis - those that are expected to be high in value) are higher than expectation (Above the line). Which means that the points that are expected to have high values - have values even higher that that.</p></li>
<li><p>Since points on the left side (Low on the X axis - those that are expected to be lower in value) are higher than expectation (Above the line). Which means that the points that are expected to have lower values - have values higher than expected.</p></li>
</ul>
<p>Now consider what this would mean for a histogram. It means that there are fewer actually observed low values, and more of the actually observed high values. So overall the distribution seems to be right skewed (since Right = Higher).</p>
<p>Let’s confirm it with a histogram.</p>
<pre class="r"><code># ggplot qqplot
rs &lt;- ggplot(data = distributions) +
    aes(x = right_skewed) +
    theme_minimal() +
    geom_histogram(bins = 50, fill = &quot;white&quot;, color = &quot;black&quot;) +
    labs(title = &quot;Right Skewed Distribution&quot;) +
    geom_vline(xintercept = mean(distributions$right_skewed), size = 0.5, color = &quot;red&quot;) +
    geom_vline(xintercept = median(distributions$right_skewed), size = 0.5, color = &quot;blue&quot;)
rs</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Right%20Skew%20Hist-1.png" width="576" /></p>
<p>As we can see - there are seems to be a longer tail on the right than on the left. Mean is the red vertical line and median the blue one. This also shows that comparing mean to median might not be a good guide on how skewed the distributions are.</p>
<p>And now we can see in terms of numbers: The mean is 0, and SD is 1 (since I standardized the data beforehand), and there are points as far as 4 SD away on the right, while there are almost no points that are 2 SD away on the left.</p>
<p>Let’s see another example.</p>
<pre class="r"><code># ggplot qqplot
ht &lt;- ggplot(data = distributions) +
    aes(sample = heavy_tailed) +
    theme_minimal() +
    geom_qq() +
    geom_qq_line() +
    labs(title = &quot;Heavy Tailed Distribution&quot;)
ht</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Heavy%20Tail%20QQ-1.png" width="576" /></p>
<p>This is a great example of what a heavy tailed distribution can look like, and also why you should not always remove your outliers at the start. It seems that the points are pretty close to a normal except for one observation that is very far off the line. Let’s remove that extreme observation and redo the plot</p>
<pre class="r"><code># ggplot qqplot
distributions %&gt;% filter(heavy_tailed != min(heavy_tailed)) %&gt;%
    ggplot() +
    aes(sample = heavy_tailed) +
    theme_minimal() +
    geom_qq() +
    geom_qq_line() +
    labs(title = &quot;Heavy Tailed Distribution&quot;) -&gt; ht
ht</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Heavy%20Tail%20QQ%20minus%20extreme-1.png" width="576" /></p>
<p>With the point removed, the scaling of the plot changes and we can see that both the right and the left tails are quite far off the line. (And we should keep in mind that we have an extreme observation with a very negative value)</p>
<p>Again the interpretation would go along these lines:</p>
<ul>
<li><p>The points on the right side (expected high values) are much higher (above the line) than expected.</p></li>
<li><p>The points on the left side (expected low values) are lower than (below the line) than expected.</p></li>
</ul>
<p>Combining these two we see that the low values are lower and high values are higher than what we would expect from a normal. This is exactly what we mean when we say “heavy tails” - there are more extreme observations both positive and negative.</p>
<p>Let’s see what a histogram would look like:</p>
<pre class="r"><code># ggplot qqplot
distributions %&gt;% filter(heavy_tailed != min(heavy_tailed)) %&gt;%
    ggplot() +
    aes(x = heavy_tailed) +
    theme_minimal() +
    geom_histogram(bins = 100, fill = &quot;white&quot;, color = &quot;black&quot;) +
    labs(title = &quot;Heavy Tailed Distribution&quot;) +
    geom_vline(xintercept = mean(distributions$heavy_tailed), size = 0.5, color = &quot;red&quot;) +
    geom_vline(xintercept = median(distributions$heavy_tailed), size = 0.5, color = &quot;blue&quot;) -&gt; ht
ht</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Heavy%20Tailed%20Hist-1.png" width="576" /></p>
<p>We can see that even with the extreme negative observation removed the scale of the histogram is so wide that it looks like one peak on a bad scale. Let’s see a less extreme example of a heavy tailed distribution:</p>
<pre class="r"><code># ggplot qqplot
ht &lt;- ggplot(data = distributions) +
    aes(sample = heavy_tailed_2) +
    theme_minimal() +
    geom_qq() +
    geom_qq_line() +
    labs(title = &quot;(Less) Heavy Tailed Distribution&quot;)
ht</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Heavy%20Tailed%202%20QQ-1.png" width="576" /></p>
<pre class="r"><code>ht &lt;- ggplot(data = distributions) +
    aes(x = heavy_tailed_2) +
    theme_minimal() +
    geom_histogram(bins = 100, fill = &quot;white&quot;, color = &quot;black&quot;) +
    labs(title = &quot;(Less) Heavy Tailed Distribution&quot;) +
    geom_vline(xintercept = mean(distributions$heavy_tailed_2), size = 0.5, color = &quot;red&quot;) +
    geom_vline(xintercept = median(distributions$heavy_tailed_2), size = 0.5, color = &quot;blue&quot;)
ht</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Heavy%20Tailed%202%20QQ-2.png" width="576" /></p>
<p>As you can see the histogram seems “Bell shaped” and “Symmetric”, and yet we know that the distribution is (very much) not normal. If we conducted a Shapiro-Wilk Test (which is a test for non-normality), we would learn that the probability of observing a data as extreme as this from a normal distribution is 0 which is pretty much 0.</p>
<p>This is why you should always do some normality checks beyond looking at a histogram, especially when your data looks normal.</p>
<p>Now, for the sake of completion let’s look at a left skewed distribution:</p>
<pre class="r"><code># ggplot qqplot
ls &lt;- ggplot(data = distributions) +
    aes(sample = left_skewed) +
    theme_minimal() +
    geom_qq() +
    geom_qq_line() +
    coord_fixed() +
    labs(title = &quot;Left Skewed Distribution&quot;)
ls</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Left%20Skew%20QQ-1.png" width="576" /></p>
<p>Again, points on the left (expected to be low), fall below the line which means they are even lower than expected, while points on the right (expected to be high) also fall below the line, so they are lower than expected as well. Since both high and low points are lower than expected that means our distribution is skewed to the left. Let’s confirm with a histogram:</p>
<pre class="r"><code># ggplot qqplot
ls &lt;- ggplot(data = distributions) +
    aes(x = left_skewed) +
    theme_minimal() +
    geom_histogram(bins = 100, fill = &quot;white&quot;, color = &quot;black&quot;) +
    labs(title = &quot;Left Skewed Distribution&quot;) +
    geom_vline(xintercept = mean(distributions$left_skewed), size = 0.5, color = &quot;red&quot;) +
    geom_vline(xintercept = median(distributions$left_skewed), size = 0.5, color = &quot;blue&quot;)
ls</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Left%20Skew%20Hist-1.png" width="576" /></p>
<p>And finally a light tailed distribution:</p>
<pre class="r"><code># ggplot qqplot
lt &lt;- ggplot(data = distributions) +
    aes(sample = light_tailed) +
    theme_minimal() +
    geom_qq() +
    geom_qq_line() +
    labs(title = &quot;Light tailed Distribution&quot;)
lt</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Light%20tailed%20QQ-1.png" width="576" /></p>
<p>Again, points on the left (expected to be low), fall above the line which means they are higher than expected, while points on the right (expected to be high) fall below the line, so they are lower than expected as well. Now the distribution that has lower points higher than expected and higher points lower than expected (i.e. more squished in the middle), is what we mean when we say “light tailed”.</p>
<p>Let’s confirm with a histogram:</p>
<pre class="r"><code># ggplot qqplot
lt &lt;- ggplot(data = distributions) +
    aes(x = light_tailed) +
    theme_minimal() +
    geom_histogram(bins = 100, fill = &quot;white&quot;, color = &quot;black&quot;) +
    labs(title = &quot;Light Tailed Distribution&quot;) +
    geom_vline(xintercept = mean(distributions$light_tailed), size = 0.5, color = &quot;red&quot;) +
    geom_vline(xintercept = median(distributions$light_tailed), size = 0.5, color = &quot;blue&quot;)
lt</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Light%20tail%20Hist-1.png" width="576" /></p>
<p>Now, this histogram does not make it seem like we have light tails, since the points are quite spread out, one could even guess that we have heavy tails because there is so much spread. This does not take into account that all of what you see in the histogram is the “peak” of the distribution. The tails are so light that essentially they don’t exist! Again this is more evidence that you should look at more than just the histogram of your data.</p>
<p>To illustrate, I will plot the “light tailed” histogram with normal distribution density overlaid:</p>
<pre class="r"><code># ggplot qqplot
lt &lt;- ggplot(data = distributions) +
    aes(x = light_tailed) +
    theme_minimal() +
    geom_histogram(aes(y = ..density..),bins = 100, fill = &quot;white&quot;, color = &quot;black&quot;) +
    labs(title = &quot;Light Tailed Distribution&quot;) +
    geom_vline(xintercept = mean(distributions$light_tailed), size = 0.5, color = &quot;red&quot;) +
    geom_vline(xintercept = median(distributions$light_tailed), size = 0.5, color = &quot;blue&quot;) +
    stat_function(fun = dnorm, args = list(mean = mean(distributions$light_tailed),
                                           sd = sd(distributions$light_tailed))) +
    xlim(-4, 4)
lt</code></pre>
<p><img src="StatsResources_files/figure-html/QQplots%20intuition%20-%20Light%20tail%20Hist%20with%20Norm-1.png" width="576" /></p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
