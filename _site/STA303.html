<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Michal Malyska" />


<title>STA303 Materials</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Michal Malyska</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-university"></span>
     
    Teaching
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="STA303.html">
        <span class="fa fa-book"></span>
         
        STA303 - Methods of Data Analysis II
      </a>
    </li>
    <li>
      <a href="STA314.html">
        <span class="fa fa-book"></span>
         
        STA314 - Machine Learning I
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Course Work
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="STA410_A1.html">
        <span class="fa fa-code"></span>
         
        STA410 - Computational Statistics - Assignment 1
      </a>
    </li>
    <li>
      <a href="STA_490_ReactionTimes_Project.html">
        <span class="fa fa-code"></span>
         
        STA490 - Stats Consulting and Collaboration
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-pencil"></span>
     
    Personal Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ASNA2019CC_datacreation.html">
        <span class="fa fa-code"></span>
         
        ASNA2019 Case Competition
      </a>
    </li>
    <li>
      <a href="Kaggle.html">
        <span class="fa fa-code"></span>
         
        Kaggle Competitions
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About me
  </a>
</li>
<li>
  <a href="resume.pdf">
    <span class="fa fa-file-pdf-o"></span>
     
    Resume
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">STA303 Materials</h1>
<h4 class="author"><em>Michal Malyska</em></h4>

</div>


<div id="resources" class="section level1">
<h1>Resources:</h1>
<p>There is a number of resources available for you to learn and master the tidyverse package, which is what you will be using if you ever work with R. It’s technically not required for the course but it will make your life a lot easier.</p>
<p><a href="http://r4ds.had.co.nz/">Learn R with tidyverse</a> - this on it’s own should give you good enough background to handle most of the coding you will ever do in R, both in class, and in a professional setting.</p>
<p><a href="https://adv-r.hadley.nz/">Advanced R with tidyverse</a> - most likely far beyond the scope of what’s needed for the course, but a great resource if you want to get involved with R.</p>
<p><a href="https://www.rstudio.com/resources/cheatsheets/">Cheatsheets</a> - very useful set of cheatsheets that you should probably keep open whenever you are working with tidyverse. (Especially the visiualization one)</p>
<p>Some other packages you should consider looking into, that will come handy during this class:</p>
<p>“car” - it is “the package” for regression models, which are the main topic of this course.</p>
<p>“summarytools” - contains function “dfSummary” which is the fastest way to get meaningful first glance at the data. It’s a good compromise between the ease of using “summary” or “glance”, and providing as much information as possible.</p>
<p>“forcats” - package for working with factors in r, part of the tidyverse family but not included in the tidyverse itself.</p>
</div>
<div id="week-0" class="section level1">
<h1>Week 0</h1>
<pre class="r"><code>library(gridExtra)
library(MASS)
library(ISLR)
library(car)
library(modelr)
library(gapminder)
library(broom)
library(e1071)
library(summarytools)
library(tidyverse)

set.seed(217828)</code></pre>
<p>Just to cover all bases below I will show you the simple workflow that I follow when working with a new dataset, like you will be doing multiple times throughout the course:</p>
<div id="rstudio-setup-and-settings" class="section level2">
<h2>RStudio Setup and settings</h2>
<p>If this is your first time using RStudio, you should adjust your settings:</p>
<ul>
<li><p>Navigate to Tools -&gt; Global Options</p></li>
<li><p>Change “Save workspace to .RData on exit” to Never</p></li>
<li><p>Uncheck “Restore .RData into workspace at startup”</p></li>
</ul>
<p>This is what mine look like:</p>
<div class="figure">
<img src="figures/RStudio%20Setup.png" />

</div>
<p>Now, every time you want to start working on something, you should begin by creating an Rproject. This helps you keep track of the files, sets your working directory so that data loading is easier, and you should always do it.</p>
<p>Now that we have all that out of the way let’s start with what to do once you have RStudio open and ready to work.</p>
</div>
<div id="file-setup" class="section level2">
<h2>File Setup</h2>
<p>Since you will need to create pdfs from your code with figures and equations you will be using the knitr package and will be working in .Rmd files. This is the most common way to write anything in R that isn’t pure code. Make sure you have some distribution of LaTeX downloaded as it is necessary to create the pdfs. I recommend MikTeX, but it shouldn’t matter which one you have in this course.</p>
<p>When you create a new .Rmd file you will notice that at the top it will have a header containing the file title, your name and date. If you want to add a table of contents (which is created from headers) just change the output line to look like this:</p>
<div class="figure">
<img src="figures/Table%20of%20contents%20output.png" />

</div>
</div>
<div id="loading-data" class="section level2">
<h2>Loading Data</h2>
<p>First let’s see how we would load data from a downloaded “.csv” file:</p>
<p>The example dataset will be the one create for the Actuarial Students National Association case competition technical challenge from this year. If you are interested in how the data was created you can check out the personal projects tab and find it under “ASNA Case Comp”.</p>
<pre class="r"><code># Load in the example.csv file that is in the working directory (this is assuming either the project
# was created or manual change of working directory happened before this line)

# Using Base reading (not advised)
data1 &lt;- read.csv(&quot;training_data.csv&quot;)

# Using Tidyverse loading
data2 &lt;- read_csv(&quot;training_data.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_double(),
##   Education = col_character(),
##   EmploymentStatus = col_character(),
##   Income = col_double(),
##   `Marital Status` = col_character(),
##   `State Code` = col_character(),
##   Coverage = col_character(),
##   Gender = col_character(),
##   `Location Code` = col_character(),
##   `Monthly Premium Auto` = col_double(),
##   `Months Since Last Claim` = col_double(),
##   `Months Since Policy Inception` = col_double(),
##   `Number of Open Complaints` = col_double(),
##   `Number of Policies` = col_double(),
##   `Claim Reason` = col_character(),
##   `Sales Channel` = col_character(),
##   `Vehicle Class` = col_character(),
##   `Vehicle Size` = col_character(),
##   `Claim Class` = col_double()
## )</code></pre>
<pre class="r"><code># Load data specifying all possible options:
data3 &lt;- read_csv(file = &quot;training_data.csv&quot;, # file path relative to WD
                  col_names = TRUE, # Does the file include column names
                  na = c(&quot;&quot;, &quot;NA&quot;, &quot;N/A&quot;), # What are the missing values in the file 
                  #(specified in a vector)
                  quoted_na = TRUE, # should missing values inside of quotes be missing
                  skip = 0, # How many lines to skip
                  n_max = Inf, # How many lines to read at most (Inf = infinity)
                  guess_max = 10000 # How many records to use to guess the type of column
                  # if not specified in col_types = c()
                  )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_double(),
##   Education = col_character(),
##   EmploymentStatus = col_character(),
##   Income = col_double(),
##   `Marital Status` = col_character(),
##   `State Code` = col_character(),
##   Coverage = col_character(),
##   Gender = col_character(),
##   `Location Code` = col_character(),
##   `Monthly Premium Auto` = col_double(),
##   `Months Since Last Claim` = col_double(),
##   `Months Since Policy Inception` = col_double(),
##   `Number of Open Complaints` = col_double(),
##   `Number of Policies` = col_double(),
##   `Claim Reason` = col_character(),
##   `Sales Channel` = col_character(),
##   `Vehicle Class` = col_character(),
##   `Vehicle Size` = col_character(),
##   `Claim Class` = col_double()
## )</code></pre>
<pre class="r"><code># This is to remove two of the redundant data files from my wd
df &lt;- data3
rm(list = c(&quot;data1&quot;, &quot;data2&quot;, &quot;data3&quot;))</code></pre>
<p>In most cases you will want to specify at least some of the parameters from the cell above, especially helpful is guess_max, and na. However in this course we will be working mostly with nicely formatted data so it shouldn’t be an issue.</p>
<p>I will skip showing you base R way of analyzing data, I’ve never seen it used outside of classes, and is neither easier nor faster. If you are really interested and want to work in a field that has extremely harsh regulations regarding software (clinical trials maybe?), you can use the swirl package to learn doing it.</p>
<pre class="r"><code># Take a first glance at the data:
dfSummary(df)</code></pre>
<pre><code>## Data Frame Summary   
## df     
## N: 45000   
## --------------------------------------------------------------------------------------------------------------------------------------------
## No   Variable                         Stats / Values                     Freqs (% of Valid)      Text Graph               Valid    Missing  
## ---- -------------------------------- ---------------------------------- ----------------------- ------------------------ -------- ---------
## 1    id                               mean (sd) : 22499.5 (12990.53)     45000 distinct values   : : : : : : : : : :      45000    0        
##      [numeric]                        min &lt; med &lt; max :                                          : : : : : : : : : :      (100%)   (0%)     
##                                       0 &lt; 22499.5 &lt; 44999                                        : : : : : : : : : :                        
##                                       IQR (CV) : 22499.5 (0.58)                                  : : : : : : : : : :                        
##                                                                                                  : : : : : : : : : :                        
## 
## 2    Education                        1. Bachelor                        13617 (30.3%)           IIIIIIIIIIIIIIII         45000    0        
##      [character]                      2. College                         12965 (28.8%)           IIIIIIIIIIIIIII          (100%)   (0%)     
##                                       3. Doctor                          1689 ( 3.8%)            I                                          
##                                       4. High School or Below            13133 (29.2%)           IIIIIIIIIIIIIII                            
##                                       5. Master                          3596 ( 8.0%)            IIII                                       
## 
## 3    EmploymentStatus                 1. Disabled                        1992 ( 4.4%)            I                        45000    0        
##      [character]                      2. Employed                        28104 (62.5%)           IIIIIIIIIIIIIIII         (100%)   (0%)     
##                                       3. Medical Leave                   2177 ( 4.8%)            I                                          
##                                       4. Retired                         1332 ( 3.0%)                                                       
##                                       5. Unemployed                      11395 (25.3%)           IIIIII                                     
## 
## 4    Income                           mean (sd) : 37563.34 (30298.03)    5657 distinct values    :                        45000    0        
##      [numeric]                        min &lt; med &lt; max :                                          :                        (100%)   (0%)     
##                                       0 &lt; 33879 &lt; 99981                                          :   :                                      
##                                       IQR (CV) : 61987 (0.81)                                    :   : : . . . .                            
##                                                                                                  : : : : : : : : : :                        
## 
## 5    Marital Status                   1. Divorced                        6673 (14.8%)            IIII                     45000    0        
##      [character]                      2. Married                         26096 (58.0%)           IIIIIIIIIIIIIIII         (100%)   (0%)     
##                                       3. Single                          12231 (27.2%)           IIIIIII                                    
## 
## 6    State Code                       1. IA                              12757 (28.3%)           IIIIIIIIIIIII            45000    0        
##      [character]                      2. KS                              3972 ( 8.8%)            IIII                     (100%)   (0%)     
##                                       3. MO                              15500 (34.4%)           IIIIIIIIIIIIIIII                           
##                                       4. NE                              8447 (18.8%)            IIIIIIII                                   
##                                       5. OK                              4324 ( 9.6%)            IIII                                       
## 
## 7    Coverage                         1. Basic                           27331 (60.7%)           IIIIIIIIIIIIIIII         45000    0        
##      [character]                      2. Extended                        13582 (30.2%)           IIIIIII                  (100%)   (0%)     
##                                       3. Premium                         4087 ( 9.1%)            II                                         
## 
## 8    Gender                           1. F                               22947 (51.0%)           IIIIIIIIIIIIIIII         45000    0        
##      [character]                      2. M                               22053 (49.0%)           IIIIIIIIIIIIIII          (100%)   (0%)     
## 
## 9    Location Code                    1. Rural                           8834 (19.6%)            IIII                     45000    0        
##      [character]                      2. Suburban                        28481 (63.3%)           IIIIIIIIIIIIIIII         (100%)   (0%)     
##                                       3. Urban                           7685 (17.1%)            IIII                                       
## 
## 10   Monthly Premium Auto             mean (sd) : 93.07 (34.3)           201 distinct values     :                        45000    0        
##      [numeric]                        min &lt; med &lt; max :                                          :                        (100%)   (0%)     
##                                       61 &lt; 83 &lt; 298                                              :                                          
##                                       IQR (CV) : 41 (0.37)                                       : : .                                      
##                                                                                                  : : : .   .                                
## 
## 11   Months Since Last Claim          mean (sd) : 15.07 (10.09)          36 distinct values      : .                      45000    0        
##      [numeric]                        min &lt; med &lt; max :                                          : :   :   .              (100%)   (0%)     
##                                       0 &lt; 14 &lt; 35                                                : : : : : : . :   .                        
##                                       IQR (CV) : 17 (0.67)                                       : : : : : : : : : :                        
##                                                                                                  : : : : : : : : : :                        
## 
## 12   Months Since Policy Inception    mean (sd) : 48.06 (27.92)          100 distinct values     . . . : : : . .          45000    0        
##      [numeric]                        min &lt; med &lt; max :                                          : : : : : : : : : .      (100%)   (0%)     
##                                       0 &lt; 48 &lt; 99                                                : : : : : : : : : :                        
##                                       IQR (CV) : 47 (0.58)                                       : : : : : : : : : :                        
##                                                                                                  : : : : : : : : : :                        
## 
## 13   Number of Open Complaints        mean (sd) : 0.39 (0.92)            0 : 35541 (79.0%)       IIIIIIIIIIIIIIII         45000    0        
##      [numeric]                        min &lt; med &lt; max :                  1 :  5123 (11.4%)       II                       (100%)   (0%)     
##                                       0 &lt; 0 &lt; 5                          2 :  1880 ( 4.2%)                                                  
##                                       IQR (CV) : 0 (2.35)                3 :  1440 ( 3.2%)                                                  
##                                                                          4 :   704 ( 1.6%)                                                  
##                                                                          5 :   312 ( 0.7%)                                                  
## 
## 14   Number of Policies               mean (sd) : 2.97 (2.4)             1 : 16026 (35.6%)       IIIIIIIIIIIIIIII         45000    0        
##      [numeric]                        min &lt; med &lt; max :                  2 : 11307 (25.1%)       IIIIIIIIIII              (100%)   (0%)     
##                                       1 &lt; 2 &lt; 9                          3 :  5732 (12.7%)       IIIII                                      
##                                       IQR (CV) : 3 (0.81)                4 :  2038 ( 4.5%)       II                                         
##                                                                          5 :  1946 ( 4.3%)       I                                          
##                                                                          6 :  1826 ( 4.1%)       I                                          
##                                                                          7 :  2153 ( 4.8%)       II                                         
##                                                                          8 :  1852 ( 4.1%)       I                                          
##                                                                          9 :  2120 ( 4.7%)       II                                         
## 
## 15   Claim Reason                     1. Collision                       18562 (41.2%)           IIIIIIIIIIIIIIII         45000    0        
##      [character]                      2. Hail                            14319 (31.8%)           IIIIIIIIIIII             (100%)   (0%)     
##                                       3. Other                           5123 (11.4%)            IIII                                       
##                                       4. Scratch/Dent                    6996 (15.6%)            IIIIII                                     
## 
## 16   Sales Channel                    1. Agent                           17117 (38.0%)           IIIIIIIIIIIIIIII         45000    0        
##      [character]                      2. Branch                          12514 (27.8%)           IIIIIIIIIII              (100%)   (0%)     
##                                       3. Call Center                     8681 (19.3%)            IIIIIIII                                   
##                                       4. Web                             6688 (14.9%)            IIIIII                                     
## 
## 17   Vehicle Class                    1. Four-Door Car                   22760 (50.6%)           IIIIIIIIIIIIIIII         45000    0        
##      [character]                      2. Luxury Car                      831 ( 1.8%)                                      (100%)   (0%)     
##                                       3. Luxury SUV                      940 ( 2.1%)                                                        
##                                       4. Sports Car                      2472 ( 5.5%)            I                                          
##                                       5. SUV                             8781 (19.5%)            IIIIII                                     
##                                       6. Two-Door Car                    9216 (20.5%)            IIIIII                                     
## 
## 18   Vehicle Size                     1. Large                           4620 (10.3%)            II                       45000    0        
##      [character]                      2. Medsize                         31683 (70.4%)           IIIIIIIIIIIIIIII         (100%)   (0%)     
##                                       3. Small                           8697 (19.3%)            IIII                                       
## 
## 19   Claim Class                      mean (sd) : 2.46 (1.09)            1 : 11110 (24.7%)       IIIIIIIIIIIIII           45000    0        
##      [numeric]                        min &lt; med &lt; max :                  2 : 12128 (27.0%)       IIIIIIIIIIIIIIII         (100%)   (0%)     
##                                       1 &lt; 2 &lt; 4                          3 : 11549 (25.7%)       IIIIIIIIIIIIIII                            
##                                       IQR (CV) : 1 (0.44)                4 : 10213 (22.7%)       IIIIIIIIIIIII                              
## --------------------------------------------------------------------------------------------------------------------------------------------</code></pre>
<p>As you can see the summary provided by the dfSummary function is quite comprehensive. You see the type, what percentage of values is valid (non-missing), the simple summary (mean, median, sd, etc), a nice ASCII plot of the distribution(!!!) of data, and the number of observations in the most common values. If you were to use base R to get all of this, it would probably be around 5-6 lines of code per column of your data.</p>
<p>Now I will show you how to create a summary datasets using tidyverse and wrangle the data in general. There are a few very important functions you should learn:</p>
<ul>
<li><p><em>mutate</em> - create a column as a transformation of existing columns</p></li>
<li><p><em>select</em> - select a subset of columns</p></li>
<li><p><em>filter</em> - filter only rows fuliling the criteria</p></li>
<li><p><em>rename</em> - rename a column</p></li>
<li><p><em>group_by</em> - allows you to group your data based on a data column</p></li>
<li><p><em>summarize</em> - self explanatory</p></li>
</ul>
<p>One more very important part of the tidyverse is the pipe operator %&gt;% which feeds the results of one function as the first argument to the next function. It makes the code a lot more readable and allows you to write it in a better way since you don’t go in to out but rather in order.</p>
<p>Below I will show you some examples of how I would create some potentially interesting summaries of data:</p>
<pre class="r"><code>summary1 &lt;- df %&gt;% # This line specifies the new dataset name, and starting data + pipe into
    select(`Vehicle Size`, `Claim Class`, `Monthly Premium Auto`, Coverage, `Marital Status`) %&gt;%
    # I select only the few columns of interest
    filter(`Monthly Premium Auto` &gt; 65) %&gt;% # I only want the people that have Auto premiums above
    # 65, this will usually come from the business or research question you are trying to answer
    group_by(`Vehicle Size`, Coverage, `Marital Status`) %&gt;% # I want to summarize
    #them by the categorical variables
    summarise(mean_prem = mean(`Monthly Premium Auto`), # I want to have mean auto premium
              count = n(), # Count of those vehicles
              avg_sev = mean(`Claim Class`) # I want to have the average Claim Class (severity)
              )
# Now I will take this created summary and analyze it further:

summary2 &lt;- summary1 %&gt;% 
    mutate(Total_Premium = mean_prem * count) %&gt;% # I create the total premium from the group
    # as Average Premium * count of policies in that group
    filter(Total_Premium &gt; 100000) # Filter out lines of business that are
    # under 100k in total premium

# This is the subset of data that might be of interest to me, let&#39;s look at it again:
dfSummary(summary2)</code></pre>
<pre><code>## Data Frame Summary   
## summary2     
## N: 11   
## -------------------------------------------------------------------------------------------------------------------------
## No   Variable          Stats / Values                       Freqs (% of Valid)   Text Graph            Valid    Missing  
## ---- ----------------- ------------------------------------ -------------------- --------------------- -------- ---------
## 1    Vehicle Size      1. Large                             1 ( 9.1%)            II                    11       0        
##      [character]       2. Medsize                           7 (63.6%)            IIIIIIIIIIIIIIII      (100%)   (0%)     
##                        3. Small                             3 (27.3%)            IIIIII                                  
## 
## 2    Coverage          1. Basic                             6 (54.5%)            IIIIIIIIIIIIIIII      11       0        
##      [character]       2. Extended                          4 (36.4%)            IIIIIIIIII            (100%)   (0%)     
##                        3. Premium                           1 ( 9.1%)            II                                      
## 
## 3    Marital Status    1. Divorced                          2 (18.2%)            IIIII                 11       0        
##      [character]       2. Married                           6 (54.5%)            IIIIIIIIIIIIIIII      (100%)   (0%)     
##                        3. Single                            3 (27.3%)            IIIIIIII                                
## 
## 4    mean_prem         mean (sd) : 98.62 (0.85)             11 distinct values           :             11       0        
##      [numeric]         min &lt; med &lt; max :                                                 :             (100%)   (0%)     
##                        96.54 &lt; 98.88 &lt; 99.92                                             :                               
##                        IQR (CV) : 0.47 (0.01)                                            :                               
##                                                                                  :   : : : : :                           
## 
## 5    count             mean (sd) : 2916.36 (2459.23)        11 distinct values   :                     11       0        
##      [integer]         min &lt; med &lt; max :                                         :                     (100%)   (0%)     
##                        1204 &lt; 2204 &lt; 9356                                        : :                                     
##                        IQR (CV) : 2112 (0.84)                                    : : :                                   
##                                                                                  : : :   :                               
## 
## 6    avg_sev           mean (sd) : 2.56 (0.04)              11 distinct values     : :                 11       0        
##      [numeric]         min &lt; med &lt; max :                                           : :                 (100%)   (0%)     
##                        2.48 &lt; 2.56 &lt; 2.64                                          : : .                                 
##                        IQR (CV) : 0.05 (0.02)                                      : : :                                 
##                                                                                  : : : :                                 
## 
## 7    Total_Premium     mean (sd) : 287671.09 (242094.78)    11 distinct values   :                     11       0        
##      [numeric]         min &lt; med &lt; max :                                         :                     (100%)   (0%)     
##                        119142 &lt; 218013 &lt; 920662                                  : :                                     
##                        IQR (CV) : 210999.5 (0.84)                                : : :                                   
##                                                                                  : : :   :                               
## -------------------------------------------------------------------------------------------------------------------------</code></pre>
<p>Normally at this point I would be making some simple graphs and reporting back to the business what they wanted to know, or digging deeper for causes depeinding on the communicated need. If this was part of my own project I would try to investigate further why there are not that many large cars in our book and why are the “Premium” coverages not a big part of our business.</p>
<p>To get started with the visualisation part, I will prepare some simple graphs from the newly obtained summary data. The main plotting function we will be using is ggplot2 (as opposed to built in functions), the syntax is not very intuitive at first, and there are some kinks you will have to figure out, but ultimately the combination of dplyr (tidyverse) data wrangling and analysis with ggplot2 makes for a very powerful and simple to use set of tools.</p>
<pre class="r"><code>plot &lt;- ggplot(data = summary2, # Create a plot object, from summary2
               mapping = aes(x = `Vehicle Size`, # x axis is Vehicle Size
                            y = `Total_Premium`, # y axis is Total Premium
                            fill = Coverage)) + # The inside of the figures is colored by coverage
    geom_col(show.legend = TRUE) + # Add a column plot (barplot is for frequencies in ggplot2)
    coord_flip() + # Flip the chart to be sideways
    theme_minimal() + # Set the minimal theme
    labs(title = &quot;Simple plotting illustration&quot;, # Add title
         x = &quot;Vehicle Size&quot;, # Rename X axis
         y = &quot;Total Premium($)&quot;) # Rename Y axis 

plot # Show the plot</code></pre>
<p><img src="STA303_files/figure-html/basic%20graphs%20in%20ggplot2-1.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
